// Copyright 2020 The Kubermatic Kubernetes Platform contributors.
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//     http://www.apache.org/licenses/LICENSE-2.0
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

@import 'variables';
@import 'mixins';
@import '~@angular/material/theming';

@include mat-core();

@mixin theme($theme, $colors) {
  $palette-foreground: map-get($theme, foreground);
  $palette-background: map-get($theme, background);

  $text: mat-color($palette-foreground, text);
  $text-secondary: mat-color($palette-foreground, secondary-text);
  $text-disabled: mat-color($palette-foreground, disabled-text);
  $checkbox-disabled: mat-color($palette-foreground, disabled-checkbox);

  $background: mat-color($palette-background, background);
  $background-hover: mat-color($palette-background, hover);
  $background-card: mat-color($palette-background, card);
  $background-dialog: mat-color($palette-background, dialog);
  $background-disabled-button: mat-color($palette-background, disabled-button);
  $background-app-bar: mat-color($palette-background, app-bar);

  $divider: mat-color($palette-foreground, divider);
  $divider-disabled: mat-color($palette-foreground, disabled);

  $chip-background: $divider;

  $project-switch: rgba(mat-color($palette-foreground, secondary-text), .7);

  .km-code-block {
    background-color: $divider;
    color: $text;
  }

  // TODO: check this?
  .km-no-item {
    border-color: $divider;
  }

  .km-main,
  .km-main > div,
  .km-footer {
    background-color: $background;
  }

  .km-navbar {
    background-color: $background-app-bar;
    box-shadow: map-get($colors, shadow);
  }

  .km-footer {
    * {
      color: map-get($colors, footer-text);
    }

    i {
      filter: grayscale(1) brightness(0) invert(.75);
    }
  }

  .km-terms * {
    color: $text;
  }

  .km-update-available-badge {
    border: 1px solid map-get($colors, secondary);

    .km-icon-update-available-arrow {
      background-color: map-get($colors, secondary);
    }
  }

  .km-panel .panel {
    background-color: $background-app-bar;
    box-shadow: map-get($colors, shadow-dark);
    color: $text;

    .notification-info .km-icon-mask {
      background-color: $text-secondary;
    }
  }

  .km-table-dropdown {
    background-color: transparent;

    *:not(i) {
      background-color: transparent;
    }

    td.mat-cell {
      border-top: 1px solid $divider;
    }

    td:first-child {
      border-left: 1px solid $divider;
    }

    td:last-child {
      border-right: 1px solid $divider;
    }
  }

  .km-mat-row.km-pointer:hover {
    background-color: $background-hover;
  }

  .km-mat-footer-row {
    border-color: $divider;
    color: $text-secondary;

    &:hover {
      background-color: $background-hover;
    }

    button {
      background-color: transparent;
      color: $text-secondary;
    }
  }

  .km-paginator {
    border-top: 1px solid $divider;

    .mat-paginator-range-actions button:not([disabled]) {
      color: $text-secondary;
    }
  }

  .km-projects-container {
    i {
      background-color: $text;
    }

    &:hover {
      background-color: map-get($colors, project-selector-hover);
    }
  }

  .km-wizard-settings-extended-wrapper {
    .km-wizard-settings-extended-divider {
      background: $divider;
    }

    .km-wizard-settings-extended-btn {
      color: $text-secondary;

      .km-icon-arrow-down,
      .km-icon-arrow-up {
        background: $text-secondary;
      }
    }
  }

  km-wizard-summary-step {
    .header {
      &::before {
        border-color: map-get($colors, primary);
        color: $text-secondary;
      }
    }
  }

  .km-card-progress-bar {
    .km-wizard-step {
      color: $text-secondary;

      .km-wizard-step-number {
        background: $divider;
      }

      &.active {
        color: map-get($colors, primary);

        .km-wizard-step-number {
          background: map-get($colors, wizard-step-background);
        }
      }

      &.completed {
        color: map-get($colors, primary);

        .km-wizard-step-number {
          background: map-get($colors, wizard-step-background);
        }
      }
    }

    .km-wizard-step-divider {
      background: $divider;
    }
  }

  .km-version-picker-container {
    .km-version-picker {
      .mat-form-field-outline {
        color: $divider;
      }

      .km-version-picker-type {
        background: $divider;
        border-color: $divider;
      }

      .mat-form-field {
        .mat-select-value-text {
          color: $text;
        }

        div.mat-form-field-flex label {
          color: $text-secondary;
        }
      }
    }

    .km-version-picker-enabled:hover {
      .km-version-picker-type {
        border-color: map-get($colors, secondary);
      }

      .mat-form-field-outline-thick {
        color: map-get($colors, secondary);
      }

      div.mat-form-field-flex label {
        color: map-get($colors, secondary-dark);
      }
    }
  }

  .km-addon-container {
    .km-addon-menu {
      border-left: 1px solid $divider;

      &:hover {
        background-color: $background-hover;
      }
    }
  }

  .km-select-addon-dialog-option-container {
    box-shadow: 0 0 0 1px $divider;

    &:hover {
      box-shadow: 0 0 0 2px map-get($colors, secondary-hover);
    }

    .km-select-addon-dialog-option-desc {
      color: $text;
    }
  }

  .km-property-usage-bar {
    .mat-progress-bar-buffer {
      background-color: $divider;
    }

    .mat-progress-bar-fill::after {
      background-color: map-get($colors, primary-hover);
    }
  }

  .km-swagger-container {
    .info *,
    .schemes-title,
    .model-title {
      color: $text;
    }

    a {
      color: map-get($colors, primary);
    }

    .scheme-container {
      background-color: transparent;
    }
  }

  .km-select-input {
    border-bottom: 1px solid $divider;
  }

  .km-add-machine-network {
    &:hover {
      background-color: $background-hover;
    }
  }

  .km-cluster-spec-type {
    &.mat-button-toggle-group {
      .mat-button-toggle {
        background-color: $background-hover;

        &:hover {
          border: 2px solid map-get($colors, secondary);
        }

        &.mat-button-toggle-checked {
          border: 2px solid map-get($colors, primary);
        }
      }
    }
  }
}
